盘中公式分析结合整体方向

1、上轨连续天数
2、某段时间内上轨天数


大的思路：
1、先算出所有日期的相关数据因子，生成一张表
2、通过AI分析数据里的因子，决定因子的权重
3、根据因子的权重，重新计算出每个日期每个部分的分数
4、根据分数，选出分数最高的股票，重新计算出每个股票的分数，增加新的因子
5、重复上述步骤，直到满足条件为止

// 定义一个函数，用于计算每个日期的分数

1、因子的计算方法:

1、上轨连续天数
2、某段时间内上轨天数
3、上轨天数占总天数的比例


301212
300281
300920
301209

此表是某一天的所有相关数据，字段说明如下：
sma_up	sma_down	macd	is_up	consecutive_upper_days	'upper_days_counts', 'ma_amount_days_ratio_3', 'ma_amount_days_ratio_5','ma_amount_days_ratio_8',"ma_amount_days_ratio_11", 	是技术指标

total_score	amount_score	free_amount	free_amount_score	increase	increase_score	amplitude	amplitude_score	jgcyd	jgcyd_score	lspf	lspf_score	focus	focus_score	last_desire_daily	desire_daily_score	high_rating 是一个评分指标

1_day_open	1_day_max	1_day_min	1_day_close	 2_day_open	2_day_max	2_day_min	2_day_close	3_day_open	3_day_max	3_day_min	3_day_close 是数据结果


请统计并分析下面两个条件下：
1、当is_up=1时，技术指标 和 评分指标 是一个什么界限或标准时，数据结果为正数的机率更大
2、当is_up=0时，技术指标 和 评分指标 是一个什么界限或标准时，数据结果为正数的机率更大

请给出2种以上的分析方法，并得出最优解
好的，我们继续分析：
当 is_up=1 sma_up>1 macd > 0，consecutive_upper_days >= 3时


结合两种方法的结果：

当is_up=1时：

技术指标：macd > 1、sma_up = 1、ma_amount_3_days_ratio > 2。

评分指标：total_score > 60、amount_score > 80。

此时1_day_close > 0的概率约为75%。

当is_up=0时：

技术指标：macd > 0、ma_amount_5_days_ratio > 1。

评分指标：total_score > 40、free_amount_score > 50。

此时1_day_close > 0的概率约为60%。



结论
最优解：逻辑回归分析提供了更精确的指标界限和概率预测，因此更优。

建议：在实际应用中，可以优先使用逻辑回归模型，并结合业务知识调整阈值。


https://zhuanlan.zhihu.com/p/21874625617 scikit-learn 机器学习步骤介绍


上轨:= MA(CLOSE,60)+ 2*STD(CLOSE,60),LINETHICK1,COLORFFFF00;
主板:  (SUBSTR(CODE,1,2) == '60' OR SUBSTR(CODE,1,2) == '00')  AND C*1.1>= HHV(C,50) AND C*1.1>= 上轨 AND COUNT(C/REF(C,1)>=1.095,50) >1;
创业板: (SUBSTR(CODE,1,2) == '30' OR SUBSTR(CODE,1,2) == '68')  AND C*1.2>= HHV(C,50)  AND C*1.2>= 上轨 AND COUNT(C/REF(C,1)>=1.145,200)>1  ;
北证:= (SUBSTR(CODE,1,1) == '8' OR SUBSTR(CODE,1,1) == '9' OR SUBSTR(CODE,1,1) == '4' ) AND C*1.3>= HHV(C,50)   AND C*1.3>= 上轨  ;

主板涨停:= COUNT(C/REF(C,1)>=1.095,50) >=2 AND 主板  ;
创业: COUNT(C/REF(C,1)>=1.145,200)>1 ; {AND 创业板 ;}

最高价: HHV(C,50) >=  C;
成交额: ( AMOUNT>100000000 OR C/REF(C,1)>1.095);
SMAUP: C > SMA(C, 6.5, 1);
SMADOWN:  C > SMA(C, 13.5, 1);
趋:(BARSCOUNT(C)> 453 AND C> MA(C,453)) OR BARSCOUNT(C) <= 453 ;
上: C>上轨;
涨幅: C/REF(C,1) >0.95;
涨10日: C/REF(C,10) <1.70;
MACD1: MACD.MACD > 0  OR MACD.MACD >REF(MACD.MACD,1);

{强势的情况}
强: (创业板 OR 创业)
AND 最高价
AND 成交额
AND 涨幅 AND 涨10日
AND ( SMAUP AND SMADOWN AND 上)
AND MACD1
;


上轨:= MA(CLOSE,60)+ 2*STD(CLOSE,60);
主板:=  (SUBSTR(CODE,1,2) == '60' OR SUBSTR(CODE,1,2) == '00')  AND C*1.1>= HHV(C,50) AND C*1.1>= 上轨 AND COUNT(C/REF(C,1)>=1.095,50) >1;
创业板:= (SUBSTR(CODE,1,2) == '30' OR SUBSTR(CODE,1,2) == '68')  AND C*1.2>= HHV(C,50)  AND C*1.2>= 上轨 AND COUNT(C/REF(C,1)>=1.145,200)>1  ;
北证:= (SUBSTR(CODE,1,1) == '8' OR SUBSTR(CODE,1,1) == '9' OR SUBSTR(CODE,1,1) == '4' ) AND C*1.3>= HHV(C,50)   AND C*1.3>= 上轨  ;

最高价:= HHV(C,50) >=  C;
成交额:= ( AMOUNT>100000000 OR C/REF(C,1)>1.095);
SMAUP:= C > SMA(C, 6.5, 1);
SMADOWN:=  C > SMA(C, 13.5, 1);
趋:=(BARSCOUNT(C)> 453 AND C> MA(C,453)) OR BARSCOUNT(C) <= 453 ;
上:= C>=上轨;
涨幅:= C/REF(C,1) >0.95;
涨10日:= C/REF(C,10) <1.70;
MACD1:= MACD.MACD > 0  OR MACD.MACD >REF(MACD.MACD,1);

{强势的情况}
强:  (创业板 OR 主板)
AND  最高价
AND 成交额
AND 涨幅 AND 涨10日
AND ( SMAUP AND SMADOWN AND 上)
AND MACD1
;





六大类分析方法 ：
根据不同数据分析对象，常见的分析方法主要包含:分解主体分析、钻取分析、常规比较分析、大型管理模型分析、财务和因子分析、专题大数据分析。



一、分解主题分析
所谓分解主题分析，是指对于不同分析要求，我们可以初步分为营销主题、财务主题、灵活主题等，然后将这些大的主题逐步拆解为不同小的方面来进行分析。

1.1营销主题
针对销售业务的分析，可以分解为客户分析、品类分析、区域分析、消费频率、价值链分析、促销、渠道、经销商、门店分析、同比环比、社交大数据分析、行业市场分析、行业景气指数的分析、市场占有率分析等。

1.2财务主题
针对财务业务的分析，可以分解为成本费用分析、利润、历史对比、财务法定报告及分析、资本性支出分析、财务预算分析、营销投入产出效率分析、会计核算分析、企业合并分析、偿债能力分析、盈利能力分析、经营现金流量分析等。

1.3灵活主题分析
包括价格分析、灵活区域分析、贡献度分析、供应商管理分析、采购价格分析、采购返利分析、采购对标分析、仓储数量流分析、存货分析、货损/质量分析、采购预测分析、产能分析、产量分析、EHS分析、价值链分析、供应链分析、运营成本分析、替代品分析及预测、销售渠道分析、员工薪酬福利分析、销售网点分析、招聘管理分析、培训管理分析、销售预测分析、下游物流分析、员工成本分析、购买者分析、员工绩效分析、终端退货分析、售后服务质量分析、人工竞争力分析等。

二、钻取分析
所谓钻取分析，是指改变维的层次，变换分析的粒度。按照方向方式分为：向上和向下钻取。向上钻取是在某一维上将低层次的细节数据概括到高层次的汇总数据，或者减少维数;是自动生成汇总行的分析方法。向下钻取是从汇总数据深入到细节数据进行观察或增加新维的分析方法。

按照钻取的维度属性划分，可以分为按组织树钻取、按品类树钻取、按其他维度钻取。通过钻取的功能，使用户对数据能更深入了解，更容易发现问题，做出正确的决策。

2.1按组织树钻取
组织树可以按职能结构、层次结构、部门结构、职权结构来建立。要了解与职权相联系的业务情况，了解了职权的组织树就可以进行钻取分析，要了解部门销售业绩情况，可以按部门钻取分析等。

2.2按品类树钻取
所谓品类树就是指依据产品的特点，划分为的大、中、小分类结构。品类树是品类差异化的基础，必须结合经营管理的实际情况进行落地。例如要了解与物料大中小类相关的业务情况，可以按品类树钻取分析等。

2.3按其他维度钻取
例如对于各地区各年度的销售情况，可以生成地区与年度的合计行(向上钻取)。例如，用户分析“各地区、城市的销售情况”时，可以对某一个城市的销售额细分为各个年度的销售额，对某一年度的销售额，可以继续细分为各个季度的销售额(向下钻取)。

三、常规比较分析
所谓常规比较分析，是指一般比较常见的对比分析方法，例如有时间趋势分析、构成分析、同类比较分析、多指标分析、相关性分析、分组分析、象限分析等。

3.1时间趋势分析
所谓时间趋势分析是指将某种现象某一个统计指标在不同时间上的各个数值，按时间先后顺序排列而形成的序列。它是一种定量预测方法，亦称简单外延方法，在统计学中作为一种常用的预测手段被广泛应用。例如，记录了某地区第一个月，第二个月，…，第N个月的降雨量，利用时间趋势分析方法，可以对未来各月的雨量进行预报。

3.2构成分析
在统计分组的基础上计算结构指标，来反映被研究总体构成情况的方法。应用构成分析法，可从不同角度研究投资构成及其变动趋势，观察投资构成与产业结构、社会需要构成的适应关系，可以揭示事物由量变到质变的具体过程。

3.3同类比较分析
在同类事物之间通过比较分析揭示其相异点而产生新认识的方法。在实际研究中人们经常会遇到一些表面上相同但实际上并不同的现象，如果对这些现象不仔细地进行比较研究，就有可能以假当真，或以真当假。因此，在分析研究中对新发现的现象不要轻易地归类，应该认真地反复进行比较研究，尤其对那些小的差异点，更不能放过。同类比较分析经常应用到与竞争对手分析中，例如食品行业同一类食品的销量比较，鞋服行业同一类型鞋子的对比分析等。

3.4多指标分析
为统计方法的一种，包含了许多的方法，最基本的为单指标，再延伸出来的多指标分析。统计资料中有多个指标同时存在时的统计分析，是统计学的重要分支，是单指标统计的发展。

3.5相关性分析
指对两个或多个具备相关性的变量元素进行分析，从而衡量两个变量因素的相关密切程度。相关性的元素之间需要存在一定的联系或者概率才可以进行相关性分析。

3.6分组分析
指将客体(问卷、特征、现实)按研究要求进行分类编组，使得同组客体之间的差别小于各种客体之间的差别，进而进行分析研究的方法。其特点在于不依赖于原始资料分布的正常性假设，可以按任意规律分布，在分析既包括数量资料，又包括质量资料的混合资料时尤为重要。

3.7象限分析
所谓象限分析是时间管理理论的一个重要观念是重点地把主要的精力和时间集中地放在处理那些重要但不紧急的工作上，这样可以做到未雨绸缪，防患于未然。在人们的日常工作中，很多时候往往有机会去很好地计划和完成一件事。但常常却又没有及时地去做，随着时间的推移，造成工作质量的下降。因此，应把主要的精力有重点地放在重要但不紧急这个“象限”的事务上是必要的。要把精力主要放在重要但不紧急的事务处理上，需要很好地安排时间。一个好的方法是建立预约。建立了预约，自己的时间才不会被别人所占据，从而有效地开展工作。在数据处理工作中，将事情按照紧急、不紧急、重要、不重要的排列组合分成四个象限，从而有效地开展工作的方法。

四、大型管理模型分析
所谓大型管理模型分析，是指依据各种成熟的、经过实践论证的大型管理模型对问题进行分析的方法。这些管理模型有的是由高校研究机构建立的,也有一部分是由大企业或者管理咨询机构建立的,它们在长时间的企业管理理论研究和实践过程中,将企业经营管理中一些经典的相关关系以一个固定模型的方式描述出来,揭示企业系统内部很多本质性的关系,供企业用来分析自己的经营管理状况，针对企业管理出现的不同问题,能采用最行之有效的模型分析往往可以事半功倍。比较常见的大型管理模型分析包括RCV模型、阿米巴经营、品类管理分析等。

4.1RCV模型
以资源(R)、能力(C)、价值(V)3个方面建立的价值链分析体系。例如要了解某大型制造企业，从供应商采购到物流中心到干线运输以及门店的一系列情况，我们可以通过分析人员数量，设备成本，备选供应商总量，活跃供应商数量，采购量，新品导入量等来了解供应商采购这一环节情况;从交易面积，建筑成本，收货能力，收货量，周转量等来了解物流中心这一环节的情况;从车辆数量和总吨位，用油量，运输能力，运输量等来了解干线运输这一环节的情况;从门店数量，经营面积，房租成本，流量，成交量，销售收入等来了解门店这一环节的情况。

4.2阿米巴经营
将整个公司分割成许多个被称为阿米巴的小型组织，每个小型组织都作为一个独立的利润中心，按照小企业、小商店的方式进行独立经营。这种分割整体逐步细化的思想也适用于数据分析。

4.3品类管理
公司根据产品品类来进行的品牌管理，它包括高效的产品组合、货架管理、定价与促销、补货及新品引进等。例如通过品类管理我们可以分析哪些品类最受消费者喜爱，某品类购买的消费者是哪些人，消费者用什么方式购买，消费者喜欢在哪里购买等等。

五、财务和因子分析
所谓财务和因子分析，主要是指因子分析法在财务信息分析上的广泛应用。因子分析的概念起源于20世纪初的关于智力测试的统计分析，以最少的信息丢失为前提，将众多的原有变量综合成较少的几个综合指标，既能大大减少参与数据建模的变量个数，同时也不会造成信息的大量丢失，达到有效的降维。比较常用的财务和因子分析法有杜邦分析法、EVA分析、财务指标、财务比率、坪效公式、品类公式、流量公式等。

5.1杜邦分析法
利用几种主要的财务比率之间的关系来综合地分析企业的财务状况。具体来说，它是一种用来评价公司赢利能力和股东权益回报水平，从财务角度评价企业绩效的一种经典方法。其基本思想是将企业净资产收益率逐级分解为多项财务比率乘积，这样有助于深入分析比较企业经营业绩。、

5.2财务指标分析
是指总结和评价企业财务状况与经营成果的分析指标，包括偿债能力指标、运营能力指标、盈利能力指标和发展能力指标。对企业财务报表进行分析与评价通常是由报表分析者来完成的。、

5.3财务比率分析
根据同一时期财务报表中两个或多个项目之间的关系，计算其比率，以评价企业的财务状况和经营成果。财务比率可以评价某项投资在各年之间收益的变化，也可以在某一时点比较某一行业的不同企业。财务比率分析可以消除规模的影响，用来比较不同企业的收益与风险，从而帮助投资者和债权人作出理智的决策。

5.4EVA分析法
EVA是经济增加值模型(EconomicValueAdded)的简称，是SternStewart咨询公司开发的一种新型的价值分析工具和业绩评价指标，是基于剩余收益思想发展起来的新型价值模型。EVA分析法具体公式：附加经济价值(EVA)=息前税后利润-资金总成本。

此外常见的还有坪效公式：总毛利(元/月)=平均坪效(元/坪/月)*面积(坪)*毛利率(%);品类公式：总毛利(元/月)=∑单价(元/件)*单价体积(件/坪)*占坪(坪)*周转率(次/月)*毛利率(%);流量公式：总毛利(元/月)=坪流量(次/坪/月)*面积(坪)*转化率(%)*客单价(元/次)*毛利率(%)。

六、专题大数据分析
所谓专题大数据分析，是指对特定的一些规模巨大的数据进行分析。大数据常用来描述和定义信息爆炸时代产生的海量数据，并命名与之相关的技术发展与创新。常见特征是数据量大、类型繁多、价值密度低、速度快、时效低。比较常见的专题大数据分析有：市场购物篮分析、重力模型、推荐算法、价格敏感度分析、客户分组分析等分析方法。

6.1市场购物篮分析
通过购物篮/购物车所显示的信息来研究顾客的购买行为。购物篮分析最出名的一个案例就是“啤酒与尿布”：20世纪90年代的美国沃尔玛超市中，其管理人员分析销售数据时发现在某些特定的情况下，“啤酒”与“尿布”两件看上去毫无关系的商品会经常出现在同一个购物篮中，经过调查发现，原来在美国有婴儿的家庭中，一般是母亲在家中照看婴儿，年轻的父亲前去超市购买尿布。父亲在购买尿布的同时，往往会顺便为自己购买啤酒。随后沃尔玛开始在卖场尝试将啤酒与尿布摆放在相同的区域，让年轻的父亲可以同时找到这两件商品，并很快地完成购物;而沃尔玛超市也可以让这些客户一次购买两件商品、而不是一件，从而获得了很好的商品销售收入，这就是“啤酒与尿布”故事的由来。

6.2重力模型分析
应用最多的一种“出行分布模型”。因表述形态与牛顿重力定律而得名。模型认定两区间内的出行次数同出发区的出行产生数成正比，同两区间的交通阻抗的某一乘方数成正比。

6.3推荐算法
是计算机专业中的一种算法，通过一些数学算法，推测出用户可能喜欢的东西，目前应用推荐算法比较好的地方主要是网络，其中淘宝做的比较好。所谓推荐算法就是利用用户的一些行为，通过一些数学算法，推测出用户可能喜欢的东西。

6.4敏感性分析法
是指从众多不确定性因素中找出对投资项目经济效益指标有重要影响的敏感性因素，并分析、测算其对项目经济效益指标的影响程度和敏感性程度，进而判断项目承受风险能力的一种不确定性分析方法。

6.5客户分组分析
根据用户的属性数据分析，对用户进行了分组归类来分析。它其实就是常规比较分析里面的分组分析，不过主要针对的是客户群体。



综上便是针对不同数据分析对象整理的六大类分析方法，且每类里面包含各种小方法。希望对大家有所帮助~

 传统统计方法 和 机器学习方法，并附上适用场景和工具实现。

一、传统统计方法
1. 主成分分析（PCA）
作用：降维，减少特征数量，保留主要信息。

适用场景：

特征高度相关（如技术指标中的ma_amount_3_days_ratio和ma_amount_5_days_ratio）。

数据维度高（如超过20个特征）。

工具：

python
from sklearn.decomposition import PCA
pca = PCA(n_components=0.95)  # 保留95%方差
X_pca = pca.fit_transform(X)
2. 因子分析（Factor Analysis）
作用：将多个相关变量归结为少数潜在因子。

适用场景：

指标之间存在隐藏的共同因素（如“趋势强度因子”可能由macd和sma_up共同决定）。

工具：

python
from sklearn.decomposition import FactorAnalysis
fa = FactorAnalysis(n_components=5)
X_fa = fa.fit_transform(X)
3. 聚类分析（Clustering）
作用：将数据分组，发现类别间的差异。

适用场景：

需要识别不同的股票行为模式（如“高波动高增长” vs “低波动稳定”）。

工具：

python
from sklearn.cluster import KMeans
kmeans = KMeans(n_clusters=5)
clusters = kmeans.fit_predict(X)